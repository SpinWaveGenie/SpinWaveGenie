language: generic

sudo: required

branches:
  only:
    - master

matrix:
  include:
    - os: linux
      dist: trusty
      compiler: gcc
      env: PYTHON_VERSION=2.7
    - os: linux
      dist: trusty
      compiler: gcc
      env: PYTHON_VERSION=3.4
    
before_install:
  - wget -q https://cmake.org/files/v3.5/cmake-3.5.2-Linux-x86_64.tar.gz --no-check-certificate;
  - tar -xzf cmake-3.5.2-Linux-x86_64.tar.gz;
  - sudo ln -f -s ./cmake-3.5.2-Linux-x86_64/bin/cmake /usr/local/bin/cmake
  - sudo apt-get update -qq;
  - sudo apt-get install -qq libboost-dev libboost-test-dev libeigen3-dev libtbb-dev 
  - if [ "$PYTHON_VERSION" == "3.4" ];
    then
      sudo apt-get install -qq python3-dev python3-numpy;
    else
      sudo apt-get install -qq python-dev python-numpy;
    fi

before_script:
  - if [ "$PYTHON_VERSION" == "3.4" ];
    then
      cmake -DWARNINGS_AS_ERRORS=ON -DBUILD_TESTING=ON -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.4m.so -DPYTHON_INCLUDE_DIR=/usr/include/python3.4 -DPYTHON_EXECUTABLE=/usr/bin/python3;
    else
      cmake -DWARNINGS_AS_ERRORS=ON -DBUILD_TESTING=ON -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython2.7.so -DPYTHON_INCLUDE_DIR=/usr/include/python2.7 -DPYTHON_EXECUTABLE=/usr/bin/python2;
    fi

script:
  - make -j 2;
  - ctest --output-on-failure -j 2;
    
notifications:
  email:
    on_success: change
    on_failure: always
