version: 0.2.{build}

branches:
  only:
  - master

configuration: Release

environment:
  PATH: "C:/projects/ThirdPartyVC141/lib;C:/projects/spinwavegenie/build/libSpinWaveGenie/Release;%PATH%"
  matrix:
    - PYTHON_DIR: "Miniconda-x64"
      PYTHON_VERSION: 2.7
      CACHE_FILENAME: "AppveyorPython27-x64.cmake"
      image: Visual Studio 2017
    - PYTHON_DIR: "Miniconda36-x64"
	  PYTHON_VERSION: 3.6
      CACHE_FILENAME: "AppveyorPython36-x64.cmake"
      image: Visual Studio 2017
    - PYTHON_DIR: "Miniconda-x64"
      PYTHON_VERSION: 2.7
      CACHE_FILENAME: "AppveyorPython27-x64.cmake"
      image: Visual Studio 2015
    - PYTHON_DIR: "Miniconda36-x64"
      PYTHON_VERSION: 3.6
      CACHE_FILENAME: "AppveyorPython36-x64.cmake"
      image: Visual Studio 2015

platform: x64

init:
- echo %APPVEYOR_BUILD_WORKER_IMAGE%
- if "%APPVEYOR_BUILD_WORKER_IMAGE%"=="Visual Studio 2017" ( set CMAKE_GENERATOR="Visual Studio 15 2017 Win64" )
- if "%APPVEYOR_BUILD_WORKER_IMAGE%"=="Visual Studio 2015" ( set CMAKE_GENERATOR="Visual Studio 14 2015 Win64" )

install:
  - cd c:\projects
  - git clone https://github.com/SpinWaveGenie/ThirdPartyVC141.git
  - set PATH=C:/%PYTHON_DIR%;C:/%PYTHON_DIR%/Scripts;%PATH%
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  - conda info -a
  - conda create -q -n testenv python=%PYTHON_VERSION% numpy
  - activate testenv

before_build:
  - cd %APPVEYOR_BUILD_FOLDER%
  - git submodule update --init --recursive
  - md build
  - cd build
  - cmake --version
  - cmake -G %CMAKE_GENERATOR% -DBUILD_TESTING=TRUE -DWARNINGS_AS_ERRORS=ON -C ../%CACHE_FILENAME% ..

build_script:
  - cmake --build . -- /p:Configuration=Release /m:2

test_script:
  - ctest -C Release --output-on-failure
